<div class="breadcrumb-area breadcrumb-area-padding-2 bg-gray-2">
    <div class="custom-container">
        <div class="breadcrumb-content text-center">
            <ul>
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/shop">Shop</a>
                </li>
                <li class="active"><%= title  %> </li>
            </ul>
        </div>
    </div>
</div>
<div class="product-details-area padding-30-row-col pt-75 pb-55">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-12">
                <div class="product-details-wrap">
                    <div class="product-details-wrap-top">
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="product-details-slider-wrap">
                                    <div class="pro-dec-big-img-slider">
                                        <div class="single-big-img-style">
                                            <div class="pro-details-big-img">
                                                <a class="img-popup"
                                                    href="/uploads/<%= product.image  %>">
                                                    <img src="/uploads/<%= product.image  %>"
                                                        alt="<%= product.title  %> ">
                                                </a>
                                            </div>
                                            <div class="pro-details-badges product-badges-position">
                                                <% if(product.stock == true){ %> 
                                                    <span style="color: white; background-color: green;">Sale !</span>
                                                <% }else{ %> 
                                                    <span class="red">Out of Stock!</span>
                                                <% } %> 
                                            </div>
                                        </div>
                                        <% if(typeof product.images != 'undefined' && product.images.length > 0){ %> 
                                            <% var images = product.images %> 
                                            <% images.forEach(image => { %> 
                                                <div class="single-big-img-style">
                                                    <div class="pro-details-big-img">
                                                        <a class="img-popup"
                                                            href=<%= `/uploads/products/${image}` %>>
                                                            <img src=<%= `/uploads/products/${image}` %>
                                                                alt="">
                                                        </a>
                                                    </div>
                                                    <div class="pro-details-badges product-badges-position">
                                                        <span class="red">Sale !</span>
                                                    </div>
                                                </div>
                                            <% }) %>
                                        <% } %>  
                                    </div>
                                    <div class="product-dec-slider-small product-dec-small-style1">
                                        <div class="product-dec-small active">
                                            <img src="/uploads/<%= product.image  %>" alt="">
                                        </div>
                                        <% if(typeof product.images != 'undefined' && product.images.length > 0){ %> 
                                            <% product.images.forEach(image => { %> 
                                                <div class="product-dec-small">
                                                    <img src=<%= `/uploads/products/${image}` %>  alt="">
                                                </div>
                                            <% }) %> 
                                        <% } %> 
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-12">
                                <div class="product-details-content pro-details-content-pl">
                                    <div class="pro-details-category">
                                        <ul>
                                            <li><a href="/shop/category/<%= product.category.slug %>"><%= product.category.title  %>  </a></li>
                                        </ul>
                                    </div>
                                    <h1> <%= product.title  %> </h1>
                                    <div class="pro-details-brand-review">
                                        <div class="pro-details-rating-wrap">
                                            <span>5.00</span>
                                            <div class="pro-details-rating">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                            </div> 
                                            <a href="#"> (2 reviews)</a>
                                        </div>
                                    </div>
                                    <div class="pro-details-price-short-description">
                                        <div class="pro-details-price">
                                            <span class="new-price">$<%= parseFloat(product.price).toFixed(2)  %> </span>
                                            <span class="old-price">$<%= parseFloat(product.oldprice).toFixed(2)  %> </span>
                                        </div>
                                        <div class="pro-details-short-description">
                                            <p><%= product.short_description  %> .</p>
                                        </div>
                                    </div>
                                    <div class="pro-details-quality-stock-area">
                                        <span>Quantity</span>
                                        <div class="pro-details-quality-stock-wrap">
                                            <div class="product-quality">
                                                <input class="cart-plus-minus-box input-text qty text" id="qty" name="qtybutton"
                                                    value="1">
                                                    <div class="dec qtybutton">-</i></div>
                                                    <div class="inc qtybutton">+</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pro-details-action-wrap">
                                        <input type="hidden" name="prid" value="<%=  product._id %>" id="prid" />
                                        <div class="pro-details-add-to-cart">
                                            <button id="<%= (product.stock == true) ?  'add-to-cart-detail' : '' %>" <%= (product.stock == true) ?  '' : 'disabled' %>><%= (product.stock == true) ?  'Add To Cart' : 'Out Of Stock' %></button>
                                        </div>
                                        <div class="pro-details-action tooltip-style-4">
                                            <button aria-label="Add To Wishlist" onclick="addToWishList('<%= product._id %>')" ><i class="fad fa-heart"></i> </button>
                                        </div>
                                    </div>
                                    <div class="product-details-meta">
                                        <%- product.sku %> 
                                    </div>
                                    <div class="product-details-social tooltip-style-4">
                                        <a aria-label="Facebook" class="facebook" href="#"><i
                                                class="fab fa-facebook-f"></i></a>
                                        <a aria-label="Twitter" class="twitter" href="#"><i
                                                class="fab fa-twitter"></i></a>
                                        <a aria-label="Linkedin" class="linkedin" href="#"><i
                                                class="fab fa-linkedin"></i></a>
                                        <a aria-label="Tumblr" class="tumblr" href="#"><i
                                                class="fab fa-tumblr-square"></i></a>
                                        <a aria-label="Email" class="envelope" href="#"><i
                                                class="fas fa-envelope"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="product-details-wrap-bottom">
                        <div class="tab-style-1 nav mb-35">
                            <a class="active" href="#product-details-1" data-toggle="tab"> Description </a>
                            <a href="#product-details-2" data-toggle="tab"> Additional information </a>
                            <a href="#product-details-3" data-toggle="tab"> Reviews (2) </a>
                        </div>
                        <div class="tab-content">
                            <div id="product-details-1" class="tab-pane active">
                                <div class="product-details-description">
                                    <%- product.description  %> 
                                </div>
                            </div>
                            <div id="product-details-2" class="tab-pane">
                                <div class="pro-details-additional-information">
                                    <div class="additional-information">
                                        <%- product.additional  %> 
                                    </div>
                                </div>
                            </div>
                            <div id="product-details-3" class="tab-pane">
                                <div class="pro-details-review">
                                    <p><span>5.00</span> average based on 2 ratings.</p>
                                    <div class="single-pro-details-review">
                                        <div class="review-img">
                                            <img src="/images/client/client-1.jpg" alt="">
                                        </div>
                                        <div class="review-content">
                                            <div class="review-name-rating">
                                                <div class="review-rating">
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                </div>
                                                <div class="review-name">
                                                    <h6>Edna Watson</h6>
                                                </div>
                                            </div>
                                            <p>Very good and fast delivery during the week. Thank you!</p>
                                            <div class="review-date-btn">
                                                <div class="review-date">
                                                    <span> April 16, 2020 at 3:08 am </span>
                                                </div>
                                                <div class="review-btn">
                                                    <a href="#">Reply</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="single-pro-details-review">
                                        <div class="review-img">
                                            <img src="/images/client/client-2.jpg" alt="">
                                        </div>
                                        <div class="review-content">
                                            <div class="review-name-rating">
                                                <div class="review-rating">
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                </div>
                                                <div class="review-name">
                                                    <h6>Edna Watson</h6>
                                                </div>
                                            </div>
                                            <p>Very good and fast delivery during the week. Thank you!</p>
                                            <div class="review-date-btn">
                                                <div class="review-date">
                                                    <span> April 16, 2020 at 3:08 am </span>
                                                </div>
                                                <div class="review-btn">
                                                    <a href="#">Reply</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ratting-form-wrapper">
                                        <h3>Add a review </h3>
                                        <p>Your email address will not be published. Required fields are marked </p>
                                        <div class="comment-form-rating-wrap">
                                            <span>Your rating: *</span>
                                            <div class="comment-form-rating">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                            </div>
                                        </div>
                                        <div class="rating-form-style">
                                            <form action="#">
                                                <div class="row">
                                                    <div class="col-lg-6 col-md-6">
                                                        <input type="text" placeholder="Name *">
                                                    </div>
                                                    <div class="col-lg-6 col-md-6">
                                                        <input type="email" placeholder="Email *">
                                                    </div>
                                                    <div class="col-lg-12 col-md-12">
                                                        <textarea placeholder="Your review"></textarea>
                                                    </div>
                                                </div>
                                                <div class="cookies-consent">
                                                    <input type="checkbox" value="yes">
                                                    <p>Save my name, email, and website in this browser for the next
                                                        time I comment.</p>
                                                </div>
                                                <div class="form-submit">
                                                    <input type="submit" value="Submit">
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<% if(relatedproducts.length > 1){ %> 
    <div class="product-area border-top-2 pt-75 pb-70">
        <div class="custom-container">
            <div class="section-title-1 mb-40">
                <h2>Related products</h2>
            </div>
            <div class="product-slider-active-1 nav-style-2 nav-style-2-modify-3">
                <% relatedproducts.forEach(related => { %>
                    <% if(related.id !== product.id){ %> 
                        <div class="product-plr-1">
                            <div class="single-product-wrap">
                                <div class="product-img-action-wrap mb-20">
                                    <div class="product-img product-img-zoom">
                                        <a href="/shop/product/<%= related.slug  %>">
                                            <img class="default-img" src="/uploads/<%= related.image %>" alt="<%= related.title   %> ">
                                        </a>
                                    </div>
                                    <div class="product-action-1">
                                        <button aria-label="<%= (related.stock == true) ? 'Add To Cart' : 'Out Of Stock' %>" <% if(related.stock == true){ %> onclick="addToCart('<%= product._id %>')" <% } %>  ><%- (related.stock == true) ? '<i class="far fa-shopping-bag"></i>' : '<i class="fas fa-times" style="color:red"></i>'  %></button>
                                        <button aria-label="Add To Wishlist" onclick="addToWishList('<%= product._id %>')"><i class="far fa-heart"></i></button>
                                    </div>
                                </div>
                                <div class="product-content-wrap">
                                    <div class="product-category">
                                        <a href="/shop/category/<%= related.category.slug  %>"><%= related.category.title  %> </a>
                                    </div>
                                    <h2><a href="/shop/product/<%= related.slug  %>"><%= related.title  %> </a></h2>
                                    <div class="product-price">
                                        <span class="new-price">$<%= parseFloat(related.price).toFixed(2)  %></span>
                                        <span class="old-price">$<%= parseFloat(related.oldprice).toFixed(2)  %> </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% } %> 
                <% }) %>
            </div>
        </div>
    </div>
<% } %> 
<% if(product.stock == true){ %> 
<script>
    // add to cart function using hidden inputs like product detail page
const addToCartButton = document.getElementById('add-to-cart-detail');
addToCartButton.addEventListener('click', () => {
  const productId = document.getElementById('prid').value;
  const quantity = document.getElementById('qty').value;
  const cartItem = {
    id: productId,
    quantity: quantity
  };
  const data = new FormData();
  data.append('productId', productId);
  data.append('quantity', quantity);
  fetch('/cart/add-to-cart-detail', {
    method: 'POST',
    body: data
  })
    .then(response => {
      if (!response.ok) {
        toastr.error('Internal Server Error');
      }
      // return response.json();
    })
    .then(data => {
      let cart = JSON.parse(localStorage.getItem("cart")) || {};

      if (cart[productId]) {
        // If the product is already in the cart, update its quantity
        cart[productId].quantity = parseFloat(quantity) +parseFloat(cart[productId].quantity);
        toastr.success('Product Quantity Updated!');
        // toastr.success(cart[productId].quantity)
      } else {
        // If the product is not in the cart, add it
        cart[productId] = cartItem;
        toastr.success('Product Added to Cart!');
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      setTimeout(function () {
        //redirect to cart page
        window.location.href = '/cart';
      }, 1500);
    })
    .catch(error => {
      toastr.error(error);
    });
});
</script>
<% } %> 
